<app-nav-bar></app-nav-bar>
<div class="admin-dashboard">
  <app-side-bar *ngIf="role === 'admin'"></app-side-bar>
  <app-partner-side-bar *ngIf="role === 'partner'"></app-partner-side-bar>

  <div class="main-content">

    <div class="wallet-container">
      <h2>{{ role | titlecase }} Wallet</h2>

      <div class="wallet-balance">
        <p>Balance: <span class="currency-amount">{{ currency }} {{ walletBalance | number:'1.2-2' }}</span></p>
        <button *ngIf="!showRechargeInput && role === 'user'" (click)="toggleRechargeInput()" class="add-money-button">
          Add Money
        </button>
      </div>
      <div *ngIf="showRechargeInput" class="wallet-recharge">
        <input type="number" min="10" [(ngModel)]="amountToAdd" placeholder="Enter amount (â‚¹)" />
        <button (click)="onAddMoney()">Confirm Add</button>
        <button (click)="toggleRechargeInput()" style="background: transparent; border: none; color: gray; margin-top: 0.5rem;">Cancel</button>
      </div>

      <div class="transaction-history">
        <h3>Transactions</h3>

        <div class="transaction-filters">
          
          <div class="filter-group">
            <label for="startDate">Start Date</label>
            <input type="date" id="startDate" [(ngModel)]="pagination.filter!['dateFrom']" [max]="today"/>
          </div>

          <div class="filter-group">
            <label for="endDate">End Date</label>
            <input type="date" id="endDate" [(ngModel)]="pagination.filter!['dateTo']" [min]="pagination.filter!['dateFrom']" [max]="today"/>
            
          </div>

          <div class="filter-group">
            <label for="transactionType">Type</label>
            <select id="transactionType" [(ngModel)]="pagination.filter!['transactionType']">
              <option value="">All Types</option>
              <option value="credit">Credit</option>
              <option value="debit">Debit</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="minAmount">Min Amount</label>
            <input type="number" id="minAmount" placeholder="Min" [(ngModel)]="pagination.filter!['minAmount']" />
          </div>
          
          <div class="filter-group">
            <label for="maxAmount">Max Amount</label>
            <input type="number" id="maxAmount" placeholder="Max" [(ngModel)]="pagination.filter!['maxAmount']" />
          </div>

          <button (click)="applyFilters()" class="filter-button">Apply Filters</button>
          <button (click)="resetFilters()" class="reset-button">Reset</button>
        </div>

        <div *ngIf="isLoading" class="loading-message">
          <div class="spinner"></div>
          <p>Loading transactions...</p>
        </div>
        <app-data-table
          [tableData]="transactionTableData"
          [tableColumns]="tableColumns"
          [isLoading]="isLoading"
          [emptyMessage]="'No transactions found.'"
          [currentPage]="pagination.page"
          [pageSize]="pagination.pageSize"
          [totalPages]="totalPages"
          [showSearch]="false"
          [searchTerm]="searchTerm"
          (pageChange)="onPageChange($event)"
          (searchChange)="onSearchChange($event)"
        ></app-data-table>
        <p *ngIf="error" class="error-message">{{ error }}</p>
      </div>
    </div>
  </div>
</div>