<div class="data-table-container">
  <h2 *ngIf="title">{{ title }}</h2>

    <!-- Table controls: Search and Add button -->
  <div class="table-controls" *ngIf="!isLoading && tableData.length > 0">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="onSearchChange($event)"
      placeholder="Search..."
      class="search-input"
      aria-label="Search table data"
    />
    <button
      *ngIf="showAddButton"
      class="btn btn-primary"
      (click)="onAddClick()"
      aria-label="Add new item"
    >
      Add
    </button>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-indicator">Loading data...</div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && tableData.length === 0" class="empty-state">
    {{ emptyMessage }}
  </div>

  <!-- Table with data -->
  <div *ngIf="!isLoading && tableData.length > 0" class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th *ngFor="let column of tableColumns" [style.width]="column.width">
            {{ column.header }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of tableData">
          <td *ngFor="let column of tableColumns">
            <ng-container [ngSwitch]="column.type">
              <!-- Text content -->
              <ng-container *ngSwitchCase="'text'">
                {{ item[column.key] }}
              </ng-container>

            <!-- Image content - now clickable -->
              <ng-container *ngSwitchCase="'image'">
                <div class="image-cell">
                  <img
                    *ngIf="item[column.key]"
                    [src]="item[column.key]"
                    alt="Service image"
                    class="table-image"
                    (click)="onImageClick(item)"
                    (error)="onImageError($event)"
                  />
                  <div
                    *ngIf="!item[column.key]"
                    class="image-placeholder"
                    (click)="onImageClick(item)"
                  >
                    <span>ðŸ“·</span>
                  </div>
                </div>
              </ng-container>

              <!-- Button content -->
              <ng-container *ngSwitchCase="'button'">
                <button
                  [class]="column.buttonClass || 'btn-default'"
                  (click)="onButtonClick(column.key, item)"
                >
                  {{ column.buttonText || "Action" }}
                </button>
              </ng-container>

              <!-- Date formatting -->
              <ng-container *ngSwitchCase="'date'">
                <ng-container *ngIf="item[column.key]; else noSlot">
                  <span class="slot-date" [ngClass]="column.className">
                    {{ item[column.key] | date : 'dd-MM-yy | hh:mm a' }}
                  </span>
                </ng-container>
                <ng-template #noSlot>
                  <span class="slot-date cancelled">Cancelled</span>
                </ng-template>
              </ng-container>

              <!-- Status with color coding -->
              <ng-container *ngSwitchCase="'status'">
                <span [class]="'status-' + item[column.key].toLowerCase()">
                  {{ item[column.key] }}
                </span>
              </ng-container>

              <ng-container *ngSwitchCase="'dropdown'">
                <select
                  [(ngModel)]="item[column.key]"
                  (change)="
                    onDropdownChange(column.key, item[column.key], item)
                  "
                >
                  <option
                    *ngFor="let option of column.dropdownOptions"
                    [value]="option.value"
                    [selected]="option.value === item[column.key]"
                  >
                    {{ option.label }}
                  </option>
                </select>
              </ng-container>

              <ng-container *ngSwitchCase="'action-buttons'">
                <div class="action-buttons">
                  <!-- Chat button -->
                  <button 
                    *ngIf="shouldShowChatButton(item)"
                    class="btn btn-sm btn-info"
                    (click)="onButtonClick('chat', item)"
                    title="Open chat">
                    Chat
                      <!-- ðŸ’¬ -->
                  </button>
                  
                  <!-- Complete button -->
                  <button 
                    *ngIf="shouldShowCompleteButton(item)"
                    class="btn btn-sm btn-success"
                    (click)="onButtonClick('complete', item)"
                    title="Mark as complete">
                    Complete
                  </button>
                  
                  <!-- Rate button (shows after completion) -->
                  <button 
                    *ngIf="shouldShowRateButton(item)"
                    class="btn btn-sm btn-warning"
                    (click)="onButtonClick('rate', item)"
                    title="Rate service">
                    Rate
                  </button>
                </div>
              </ng-container>

              <!-- Default case -->
              <ng-container *ngSwitchDefault>
                {{ item[column.key] }}
              </ng-container>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="pagination-controls" *ngIf="totalPages > 1">
      <button
        class="btn btn-secondary"
        [disabled]="currentPage === 1"
        (click)="prevPage()"
        aria-label="Previous page"
      >
        Previous
      </button>
      <span class="pagination-info"
        >Page {{ currentPage }} of {{ totalPages }}</span
      >
      <button
        class="btn btn-secondary"
        [disabled]="currentPage === totalPages"
        (click)="nextPage()"
        aria-label="Next page"
      >
        Next
      </button>
    </div>
  </div>
</div>
