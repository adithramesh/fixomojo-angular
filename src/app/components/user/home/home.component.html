<app-nav-bar></app-nav-bar>

<main class="home-container">
  <!-- Welcome/Offers Carousel Section -->
  <section class="welcome-section">
    <div class="carousel-container">
      <!-- Welcome Card -->
      <div class="welcome-card" *ngIf="!showOffers" [@fadeInOut]>
        <h1>Welcome, {{ (username$ | async) || 'User' }}!</h1>
        <p>Phone: {{ (phoneNumber$ | async) || 'Not available' }}</p>
        <p class="subtitle">Discover our services and find what you need</p>
      </div>

      <!-- Offer Card -->
      <div class="offer-card" *ngIf="showOffers && getCurrentOffer()" [@fadeInOut]>
        <div class="offer-content">
          <div class="offer-badge">
            <span class="discount-text">{{ getDiscountText(getCurrentOffer()!) }}</span>
          </div>
          <h2>{{ getCurrentOffer()!.title }}</h2>
          <p class="offer-description">{{ getCurrentOffer()!.description }}</p>
          <div class="offer-details">
            <span *ngIf="getCurrentOffer()!.min_booking_amount" class="min-amount">
              Min booking: ₹{{ getCurrentOffer()!.min_booking_amount }}
            </span>
            <span *ngIf="getCurrentOffer()!.max_discount" class="max-discount">
              Max discount: ₹{{ getCurrentOffer()!.max_discount }}
            </span>
            <span *ngIf="getCurrentOffer()!.valid_until" class="validity">
              Valid until: {{ getCurrentOffer()!.valid_until | date:'dd MMM yyyy' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Carousel Controls -->
      <div class="carousel-controls" *ngIf="offers.length > 0">
        <button class="nav-btn prev" (click)="prevSlide()" aria-label="Previous">‹</button>
        <div class="carousel-indicators">
          <span 
            class="indicator" 
            [class.active]="currentSlide === 0"
            (click)="goToSlide(0)">
          </span>
          <span 
            *ngFor="let offer of offers; let i = index" 
            class="indicator" 
            [class.active]="currentSlide === i + 1"
            (click)="goToSlide(i + 1)">
          </span>
        </div>
        <button class="nav-btn next" (click)="nextSlide()" aria-label="Next">›</button>
      </div>
    </div>
  </section>

  <!-- Featured Services Section -->
  <section class="featured-services-section">
    <div class="section-header">
      <h2>Featured Services</h2>
      <button class="view-all-btn" (click)="viewAllServices()">
        View All Services
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading" *ngIf="isLoading">
      <p>Loading services...</p>
    </div>

    <!-- Error State -->
    <div class="error-message" *ngIf="error && !isLoading">
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadFeaturedServices()">Try Again</button>
    </div>

    <!-- Services Grid -->
    <div class="services-grid" *ngIf="!isLoading && !error && featuredServices.length > 0">
      <app-service-card
        *ngFor="let service of featuredServices"
        [title]="service.serviceName"
        [imageUrl]="_imageUrlService.buildImageUrl(service.image)"
        [isHomePage]="true"
        [showBookButton]="false"
        (click)="viewService(service)"
      ></app-service-card>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && !error && featuredServices.length === 0">
      <p>No services available at the moment.</p>
    </div>
  </section>

  <!-- Quick Actions Section -->
  <section class="quick-actions-section">
    <div class="section-header">
      <h2>Quick Actions</h2>
    </div>
    <div class="actions-grid">
      <button class="action-card" (click)="viewAllServices()">
        <h3>Browse Services</h3>
        <p>View all available services</p>
      </button>
    </div>
  </section>
</main>

<app-footer></app-footer>